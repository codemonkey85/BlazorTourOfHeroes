<PageTitle>Heroes</PageTitle>

<h2>My Heroes</h2>

<ul class="heroes">
    @foreach (var hero in heroes)
    {
        <li>
            <a href="/detail/@hero.Id">
                <span class="badge">@hero.Id</span> @hero.Name
            </a>
            <button type="button" class="delete" title="delete hero" @onclick="@(() => Delete(hero))">x</button>
        </li>
    }
</ul>

<div>
    <label for="new-hero">Hero name: </label>
    <input id="new-hero" @bind="heroName" />

    <button type="button" class="add-button" @onclick="Add">
        Add hero
    </button>
</div>

@code {
    private IList<Hero> heroes = new List<Hero>();
    private Hero? selectedHero;
    private string heroName = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await GetHeroes();
    }

    private async Task GetHeroes()
    {
        heroes = (await HeroService.GetHeroes())?.ToList() ?? new List<Hero>();
    }

    private async void Add()
    {
        var addedHero = await HeroService.AddHero(new Hero { Name = heroName.Trim() });
        if (addedHero is not null)
        {
            heroes.Add(addedHero);
            heroName = string.Empty;
        }
    }

    private async Task Delete(Hero hero)
    {
        await HeroService.DeleteHero(hero.Id);
        heroes.Remove(hero);
    }
}
